<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ«»æ¡ƒå®¶æ—¥æœ¬ä¹‹æ—…</title>
    
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'milk-tea': '#f2eee5',    /* å¥¶èŒ¶è‰²èƒŒæ™¯ */
                        'caramel': '#c9a68a',     /* ç„¦ç³–è‰²ä¸»è‰² */
                        'caramel-dark': '#a67c52', /* æ·±ç„¦ç³– */
                        'cream': '#fffcf8',       /* å¡ç‰‡å¥¶æ²¹ç™½ */
                    },
                    borderRadius: {
                        'header': '2.5rem',
                    },
                    boxShadow: {
                        'soft': '0 4px 20px rgba(201, 166, 138, 0.15)',
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f2eee5; color: #5e4b40; -webkit-tap-highlight-color: transparent; padding-bottom: 80px; }
        .header-bg {
            background-image: url('https://i.imgur.com/Hu16R1g.jpeg'); /* é è¨­å°ä¸¸å­åœ–ç‰‡ï¼Œè«‹è‡ªè¡Œæ›¿æ› */
            background-size: cover;
            background-position: center 30%;
            height: 280px;
            width: 100%;
            border-bottom-left-radius: 3rem;
            border-bottom-right-radius: 3rem;
            position: relative;
            z-index: 10;
            box-shadow: 0 4px 25px rgba(0,0,0,0.1);
        }
        .main-container { margin-top: -60px; position: relative; z-index: 20; padding: 0 16px; }
        
        /* éš±è—æ²è»¸ä½†å¯æ»‘å‹• */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* å¡ç‰‡æ‹–æ›³æ¨£å¼ */
        .draggable-source { opacity: 0.4; }
        .drag-over { border: 2px dashed #c9a68a; }

        /* æ—¥æœŸé¸å–®æ¨£å¼ */
        .date-card.active { background-color: #c9a68a; color: white; transform: scale(1.05); }
    </style>
</head>
<body>

<div id="app">
    <div class="header-bg">
        <div class="absolute bottom-4 right-6 flex gap-3 bg-white/90 backdrop-blur-sm p-2 rounded-full shadow-lg">
            <button @click="currentTab = 'itinerary'" :class="{'text-caramel-dark': currentTab === 'itinerary', 'text-gray-400': currentTab !== 'itinerary'}" class="p-3 rounded-full transition-all">
                <i class="fa-solid fa-map-location-dot text-xl"></i>
            </button>
            <button @click="currentTab = 'info'" :class="{'text-caramel-dark': currentTab === 'info', 'text-gray-400': currentTab !== 'info'}" class="p-3 rounded-full transition-all">
                <i class="fa-solid fa-circle-info text-xl"></i>
            </button>
            <button @click="currentTab = 'shopping'" :class="{'text-caramel-dark': currentTab === 'shopping', 'text-gray-400': currentTab !== 'shopping'}" class="p-3 rounded-full transition-all">
                <i class="fa-solid fa-basket-shopping text-xl"></i>
            </button>
            <button @click="currentTab = 'expense'" :class="{'text-caramel-dark': currentTab === 'expense', 'text-gray-400': currentTab !== 'expense'}" class="p-3 rounded-full transition-all">
                <i class="fa-solid fa-coins text-xl"></i>
            </button>
        </div>
    </div>

    <div class="main-container">

        <div v-if="currentTab === 'itinerary'">
            <div class="flex overflow-x-auto hide-scrollbar gap-3 pb-4 pt-2">
                <div v-for="(day, index) in tripDays" :key="index" 
                     @click="selectedDayIndex = index"
                     class="date-card min-w-[70px] bg-white rounded-2xl p-3 text-center shadow-sm cursor-pointer transition-all border border-gray-100"
                     :class="{ 'active': selectedDayIndex === index }">
                    <div class="text-lg font-bold uppercase">{{ day.week }}</div>
                    <div class="text-sm">{{ day.date }}</div>
                </div>
            </div>

            <div class="bg-blue-50/80 rounded-xl p-4 mb-4 flex items-center justify-between border border-blue-100 shadow-sm">
                <div class="flex items-center gap-3">
                    <div class="text-3xl">{{ getWeatherIcon(currentDayData.weather) }}</div>
                    <div>
                        <div class="font-bold text-gray-700">{{ currentDayData.temp }}Â°C</div>
                        <div class="text-xs text-gray-500">é«”æ„Ÿ {{ currentDayData.feels_like }}Â°C</div>
                    </div>
                </div>
                <div class="text-right text-sm text-gray-500">{{ currentDayData.location }}</div>
            </div>

            <div class="flex flex-col gap-4">
                <div v-for="(item, index) in currentDayItems" :key="item.id"
                     draggable="true"
                     @dragstart="dragStart(index)"
                     @dragover.prevent
                     @drop="drop(index)"
                     class="bg-cream rounded-xl shadow-soft border border-white relative overflow-hidden">
                    
                    <div v-if="index > 0" class="flex justify-center items-center py-2 text-xs text-gray-400 gap-2 bg-milk-tea/50">
                        <i :class="getTransportIcon(item.transportType)"></i>
                        <span @click="openGoogleMapRoute(currentDayItems[index-1].name, item.name)" class="underline cursor-pointer">
                            {{ item.transportTime || 'é»æ“Šè¨ˆç®—æ™‚é–“' }}
                        </span>
                    </div>
                    <div v-else-if="item.type !== 'flight'" class="flex justify-center items-center py-2 text-xs text-gray-400 gap-2 bg-milk-tea/50">
                        <i class="fa-solid fa-hotel"></i>
                        <span>å¾é£¯åº—å‡ºç™¼</span>
                        <i :class="getTransportIcon(item.transportType)"></i>
                        <span @click="openGoogleMapRoute(currentDayData.hotel, item.name)" class="underline cursor-pointer">
                            {{ item.transportTime || 'é»æ“Šè¨ˆç®—æ™‚é–“' }}
                        </span>
                    </div>

                    <div class="p-4" @click="openGoogleMap(item.name)">
                        <div v-if="item.type === 'flight'" class="bg-blue-50 p-3 rounded-lg border border-blue-100">
                            <div class="flex justify-between items-center mb-2">
                                <span class="badge bg-blue-500 text-white text-xs px-2 py-1 rounded">èˆªç­</span>
                                <span class="text-blue-800 font-bold">{{ item.time }}</span>
                            </div>
                            <div class="text-lg font-bold text-gray-800">{{ item.name }}</div>
                            <div class="text-sm text-gray-600 mt-1">{{ item.note }}</div>
                        </div>

                        <div v-else>
                            <div class="flex justify-between items-start mb-1">
                                <span class="px-2 py-0.5 rounded text-xs font-medium text-white" :class="getTypeColor(item.type)">
                                    {{ getTypeName(item.type) }}
                                </span>
                                <div class="flex gap-2">
                                    <button @click.stop="editItem(item)" class="text-gray-300 hover:text-caramel"><i class="fa-solid fa-pen"></i></button>
                                </div>
                            </div>
                            <h3 class="text-lg font-bold text-gray-800 mb-1">{{ item.name }}</h3>
                            <div class="text-sm text-gray-500 flex gap-3 mb-2">
                                <span v-if="item.openTime"><i class="fa-regular fa-clock mr-1"></i>{{ item.openTime }}</span>
                                <span v-if="item.ticket"><i class="fa-solid fa-ticket mr-1"></i>{{ item.ticket }}</span>
                            </div>
                            <p v-if="item.note" class="text-sm text-gray-600 bg-gray-50 p-2 rounded">{{ item.note }}</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <button @click="showAddModal = true" class="fixed bottom-6 right-6 w-14 h-14 bg-caramel hover:bg-caramel-dark text-white rounded-full shadow-lg flex items-center justify-center text-2xl z-50 transition-colors">
                <i class="fa-solid fa-plus"></i>
            </button>
        </div>

        <div v-if="currentTab === 'info'" class="flex flex-col gap-4">
            <div class="bg-white rounded-xl shadow-soft p-5 border-l-4 border-caramel">
                <h3 class="font-bold text-lg mb-3 text-caramel-dark"><i class="fa-solid fa-calculator mr-2"></i>åŒ¯ç‡æ›ç®—</h3>
                <div class="flex items-center gap-2 mb-2">
                    <input type="number" v-model="calcJpy" class="w-full p-2 border rounded bg-gray-50" placeholder="æ—¥å¹£ JPY">
                    <span class="text-gray-400">=</span>
                    <div class="w-full p-2 bg-gray-100 rounded text-gray-700 font-bold">NT$ {{ (calcJpy * exchangeRate).toFixed(0) }}</div>
                </div>
                <div class="text-xs text-right text-gray-400">åŒ¯ç‡è¨­å®š: {{ exchangeRate }}</div>
            </div>

            <div class="bg-white rounded-xl shadow-soft p-5 border-l-4 border-blue-400">
                <h3 class="font-bold text-lg mb-3 text-blue-600"><i class="fa-solid fa-plane mr-2"></i>èˆªç­è³‡è¨Š</h3>
                <div class="mb-4 border-b pb-2">
                    <div class="text-xs text-gray-500 mb-1">å»ç¨‹ | 02/14 (å…­)</div>
                    <div class="flex justify-between items-end">
                        <div class="text-2xl font-bold">TPE</div>
                        <i class="fa-solid fa-plane text-gray-300"></i>
                        <div class="text-2xl font-bold">NGO</div>
                    </div>
                    <div class="flex justify-between text-sm mt-1">
                        <span>17:15 èµ·é£›</span>
                        <span>20:50 æŠµé”</span>
                    </div>
                    <div class="text-xs text-center mt-1 bg-blue-50 text-blue-800 rounded py-1">CI150 ä¸­è¯èˆªç©º</div>
                </div>
                <div>
                    <div class="text-xs text-gray-500 mb-1">å›ç¨‹ | 02/21 (å…­)</div>
                    <div class="flex justify-between items-end">
                        <div class="text-2xl font-bold">NRT</div>
                        <i class="fa-solid fa-plane text-gray-300 transform rotate-180"></i>
                        <div class="text-2xl font-bold">TPE</div>
                    </div>
                    <div class="flex justify-between text-sm mt-1">
                        <span>14:15 èµ·é£›</span>
                        <span>17:15 æŠµé”</span>
                    </div>
                    <div class="text-xs text-center mt-1 bg-blue-50 text-blue-800 rounded py-1">CI221 ä¸­è¯èˆªç©º</div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-soft p-5 border-l-4 border-green-500">
                <h3 class="font-bold text-lg mb-3 text-green-700"><i class="fa-solid fa-bed mr-2"></i>ä½å®¿è³‡è¨Š</h3>
                <div class="mb-4">
                    <h4 class="font-bold">åå¤å±‹ JR é–€æ¨“é£¯åº—</h4>
                    <p class="text-sm text-gray-600 mb-1">ğŸ“ +81-52-5662111</p>
                    <p class="text-sm text-gray-600 mb-2">ğŸ“ åå¤å±‹å¸‚ä¸­æ‘å€åç«™1-1-3</p>
                    <button @click="openGoogleMap('åå¤å±‹JRé–€æ¨“é£¯åº—')" class="w-full py-1 bg-green-50 text-green-700 rounded text-sm">å°èˆª</button>
                </div>
                <div class="border-t pt-3">
                    <h4 class="font-bold">ä¸‰äº•èŠ±åœ’é£¯åº—å¤§æ‰‹ç”º</h4>
                    <p class="text-sm text-gray-600 mb-1">ğŸ“ +81-3-32543131</p>
                    <p class="text-sm text-gray-600 mb-2">ğŸ“ æ±äº¬éƒ½åƒä»£ç”°å€å†…ç¥ç”°2-1-2</p>
                    <button @click="openGoogleMap('ä¸‰äº•èŠ±åœ’é£¯åº—å¤§æ‰‹ç”º')" class="w-full py-1 bg-green-50 text-green-700 rounded text-sm">å°èˆª</button>
                </div>
            </div>

             <div class="bg-red-50 rounded-xl shadow-soft p-5 border border-red-100">
                <h3 class="font-bold text-lg mb-3 text-red-600"><i class="fa-solid fa-triangle-exclamation mr-2"></i>ç·Šæ€¥è¯çµ¡</h3>
                <div class="flex justify-around text-center">
                    <div>
                        <div class="text-2xl font-bold text-red-800">110</div>
                        <div class="text-xs text-gray-500">è­¦å¯Ÿå±€</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-red-800">119</div>
                        <div class="text-xs text-gray-500">æ•‘è­·è»Š/ç«è­¦</div>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="currentTab === 'shopping'">
            <div class="grid grid-cols-2 gap-4">
                <div v-for="(item, index) in shoppingList" :key="index" class="bg-white rounded-xl shadow-soft overflow-hidden relative group">
                    <button @click="removeShoppingItem(index)" class="absolute top-2 right-2 bg-red-500 text-white w-6 h-6 rounded-full text-xs z-10 opacity-80"><i class="fa-solid fa-xmark"></i></button>
                    <div class="h-32 bg-gray-100 flex items-center justify-center overflow-hidden">
                        <img v-if="item.image" :src="item.image" class="w-full h-full object-cover">
                        <i v-else class="fa-solid fa-image text-3xl text-gray-300"></i>
                    </div>
                    <div class="p-3">
                        <div class="font-bold text-gray-800 truncate">{{ item.name }}</div>
                    </div>
                </div>
            </div>
            <button @click="showShoppingModal = true" class="fixed bottom-6 right-6 w-14 h-14 bg-caramel hover:bg-caramel-dark text-white rounded-full shadow-lg flex items-center justify-center text-2xl z-50">
                <i class="fa-solid fa-plus"></i>
            </button>
        </div>

        <div v-if="currentTab === 'expense'">
            <div class="bg-caramel text-white rounded-xl p-6 mb-4 shadow-lg text-center">
                <div class="text-sm opacity-90 mb-1">ç¸½èŠ±è²» (JPY)</div>
                <div class="text-4xl font-bold">Â¥{{ totalExpense.toLocaleString() }}</div>
                <div class="text-xs opacity-75 mt-2">ç´„å°å¹£ NT$ {{ (totalExpense * exchangeRate).toFixed(0).toLocaleString() }}</div>
            </div>

            <div class="flex flex-col gap-3">
                <div v-for="(exp, index) in expenses" :key="index" class="bg-white p-4 rounded-xl shadow-sm flex justify-between items-center relative">
                     <button @click="removeExpense(index)" class="absolute -top-2 -right-2 bg-red-100 text-red-500 w-6 h-6 rounded-full text-xs"><i class="fa-solid fa-xmark"></i></button>
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full flex items-center justify-center text-white" :class="getCategoryColor(exp.category)">
                            <i :class="getCategoryIcon(exp.category)"></i>
                        </div>
                        <div>
                            <div class="font-bold text-gray-800">{{ exp.name }}</div>
                            <div class="text-xs text-gray-400">{{ exp.date }} Â· {{ exp.method }}</div>
                        </div>
                    </div>
                    <div class="font-bold text-gray-700">Â¥{{ parseInt(exp.amount).toLocaleString() }}</div>
                </div>
            </div>

            <button @click="showExpenseModal = true" class="fixed bottom-6 right-6 w-14 h-14 bg-caramel hover:bg-caramel-dark text-white rounded-full shadow-lg flex items-center justify-center text-2xl z-50">
                <i class="fa-solid fa-plus"></i>
            </button>
        </div>

    </div>

    <div v-if="showAddModal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-sm p-5 max-h-[90vh] overflow-y-auto">
            <h3 class="font-bold text-xl mb-4 text-center">{{ isEditing ? 'ç·¨è¼¯è¡Œç¨‹' : 'æ–°å¢è¡Œç¨‹' }}</h3>
            <div class="space-y-3">
                <select v-model="formItem.type" class="w-full p-2 border rounded bg-gray-50">
                    <option value="spot">æ™¯é»</option>
                    <option value="food">ç¾é£Ÿ</option>
                    <option value="shopping">è³¼ç‰©</option>
                    <option value="hotel">ä½å®¿</option>
                    <option value="flight">èˆªç­</option>
                    <option value="other">å…¶ä»–</option>
                </select>
                <input v-model="formItem.name" placeholder="åç¨±" class="w-full p-2 border rounded">
                <input v-model="formItem.openTime" placeholder="ç‡Ÿæ¥­æ™‚é–“" class="w-full p-2 border rounded" v-if="['spot','food','shopping'].includes(formItem.type)">
                <input v-model="formItem.ticket" placeholder="é–€ç¥¨è³‡è¨Š" class="w-full p-2 border rounded" v-if="formItem.type === 'spot'">
                <textarea v-model="formItem.note" placeholder="ç‰¹è‰² & å‚™è¨»" class="w-full p-2 border rounded h-20"></textarea>
                
                <div class="border-t pt-3 mt-2">
                    <label class="text-xs text-gray-500">å‰å¾€æ­¤è™•çš„äº¤é€š (ä¼°ç®—)</label>
                    <div class="flex gap-2 mt-1">
                        <select v-model="formItem.transportType" class="p-2 border rounded text-sm">
                            <option value="walk">æ­¥è¡Œ</option>
                            <option value="train">å¤§çœ¾é‹è¼¸</option>
                            <option value="car">é–‹è»Š</option>
                        </select>
                        <input v-model="formItem.transportTime" placeholder="ä¾‹å¦‚: 15åˆ†é˜" class="w-full p-2 border rounded text-sm">
                    </div>
                </div>
            </div>
            <div class="flex gap-2 mt-6">
                <button v-if="isEditing" @click="deleteItem" class="flex-1 py-2 bg-red-100 text-red-500 rounded-lg">åˆªé™¤</button>
                <button @click="closeModal" class="flex-1 py-2 bg-gray-200 rounded-lg">å–æ¶ˆ</button>
                <button @click="saveItem" class="flex-1 py-2 bg-caramel text-white rounded-lg">å„²å­˜</button>
            </div>
        </div>
    </div>

    <div v-if="showShoppingModal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-sm p-5">
            <h3 class="font-bold text-xl mb-4 text-center">æ–°å¢è³¼ç‰©æ¸…å–®</h3>
            <div class="space-y-3">
                <input v-model="shoppingForm.name" placeholder="å•†å“åç¨±" class="w-full p-2 border rounded">
                <label class="block w-full p-2 border border-dashed rounded text-center text-gray-400 cursor-pointer">
                    <i class="fa-solid fa-camera mr-2"></i>ä¸Šå‚³åœ–ç‰‡
                    <input type="file" @change="handleImageUpload" class="hidden" accept="image/*">
                </label>
                <div v-if="shoppingForm.image" class="h-20 w-full bg-gray-100 flex justify-center items-center overflow-hidden rounded">
                    <img :src="shoppingForm.image" class="h-full object-cover">
                </div>
            </div>
            <div class="flex gap-2 mt-6">
                <button @click="showShoppingModal = false" class="flex-1 py-2 bg-gray-200 rounded-lg">å–æ¶ˆ</button>
                <button @click="saveShoppingItem" class="flex-1 py-2 bg-caramel text-white rounded-lg">æ–°å¢</button>
            </div>
        </div>
    </div>

    <div v-if="showExpenseModal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-sm p-5">
            <h3 class="font-bold text-xl mb-4 text-center">è¨˜å¸³</h3>
            <div class="space-y-3">
                <input type="date" v-model="expenseForm.date" class="w-full p-2 border rounded">
                <select v-model="expenseForm.category" class="w-full p-2 border rounded bg-gray-50">
                    <option value="traffic">äº¤é€š</option>
                    <option value="food">é£²é£Ÿ</option>
                    <option value="hotel">ä½å®¿</option>
                    <option value="ticket">é–€ç¥¨</option>
                    <option value="shopping">è³¼ç‰©</option>
                    <option value="other">å…¶ä»–</option>
                </select>
                <input v-model="expenseForm.name" placeholder="é …ç›®åç¨±" class="w-full p-2 border rounded">
                <input type="number" v-model="expenseForm.amount" placeholder="é‡‘é¡ (æ—¥å¹£)" class="w-full p-2 border rounded">
                <select v-model="expenseForm.method" class="w-full p-2 border rounded bg-gray-50">
                    <option value="ç¾é‡‘">ç¾é‡‘</option>
                    <option value="ä¿¡ç”¨å¡">ä¿¡ç”¨å¡</option>
                    <option value="Suica">Suica/ICå¡</option>
                </select>
            </div>
            <div class="flex gap-2 mt-6">
                <button @click="showExpenseModal = false" class="flex-1 py-2 bg-gray-200 rounded-lg">å–æ¶ˆ</button>
                <button @click="saveExpense" class="flex-1 py-2 bg-caramel text-white rounded-lg">å„²å­˜</button>
            </div>
        </div>
    </div>

</div>

<script>
    const { createApp, ref, computed, onMounted, watch } = Vue;

    createApp({
        setup() {
            const currentTab = ref('itinerary');
            
            // è¡Œç¨‹è³‡æ–™ (é è¨­è³‡æ–™)
            const tripDays = [
                { date: '2/14', week: 'SAT', fullDate: '2026-02-14', weather: 'cloud', temp: 8, feels_like: 5, location: 'åå¤å±‹', hotel: 'åå¤å±‹JRé–€æ¨“é£¯åº—' },
                { date: '2/15', week: 'SUN', fullDate: '2026-02-15', weather: 'sun', temp: 10, feels_like: 8, location: 'åå¤å±‹', hotel: 'åå¤å±‹JRé–€æ¨“é£¯åº—' },
                { date: '2/16', week: 'MON', fullDate: '2026-02-16', weather: 'cloud', temp: 2, feels_like: -1, location: 'å‰åœåŠ›', hotel: 'åå¤å±‹JRé–€æ¨“é£¯åº—' },
                { date: '2/17', week: 'TUE', fullDate: '2026-02-17', weather: 'snow', temp: -3, feels_like: -8, location: 'åˆæŒæ‘', hotel: 'åå¤å±‹JRé–€æ¨“é£¯åº—' },
                { date: '2/18', week: 'WED', fullDate: '2026-02-18', weather: 'sun', temp: 9, feels_like: 6, location: 'æ±äº¬', hotel: 'ä¸‰äº•èŠ±åœ’é£¯åº—å¤§æ‰‹ç”º' },
                { date: '2/19', week: 'THU', fullDate: '2026-02-19', weather: 'sun', temp: 5, feels_like: 2, location: 'æ²³å£æ¹–', hotel: 'ä¸‰äº•èŠ±åœ’é£¯åº—å¤§æ‰‹ç”º' },
                { date: '2/20', week: 'FRI', fullDate: '2026-02-20', weather: 'sun', temp: 10, feels_like: 8, location: 'æ±äº¬', hotel: 'ä¸‰äº•èŠ±åœ’é£¯åº—å¤§æ‰‹ç”º' },
                { date: '2/21', week: 'SAT', fullDate: '2026-02-21', weather: 'cloud', temp: 11, feels_like: 9, location: 'æ±äº¬', hotel: 'æº«æš–çš„å®¶' }
            ];
            
            const selectedDayIndex = ref(0);
            const itineraryData = ref({}); // çµæ§‹: { '2026-02-14': [items...] }

            // é è¨­è³‡æ–™å¡«å…… (ç¯„ä¾‹)
            const initData = () => {
                if(!localStorage.getItem('itineraryData')) {
                    itineraryData.value = {
                        '2026-02-14': [
                            { id: 1, type: 'flight', name: 'CI150 æŠµé”åå¤å±‹', time: '20:50', note: 'å…¥å¢ƒé ç•™ 2.5 å°æ™‚', transportType: 'train', transportTime: '50åˆ†' },
                            { id: 2, type: 'hotel', name: 'Check-in JRé–€æ¨“é£¯åº—', openTime: '24hr', transportType: 'walk', transportTime: '5åˆ†' }
                        ],
                        '2026-02-15': [
                            { id: 3, type: 'spot', name: 'åå¤å±‹åŸ', openTime: '09:00-16:30', ticket: 'Â¥500', note: 'æ­åœ°éµåˆ°åå¤å±‹åŸç«™', transportType: 'train', transportTime: '20åˆ†' },
                            { id: 4, type: 'shopping', name: 'å¤§é ˆå•†åº—è¡—', openTime: '11:00-20:00', note: 'åƒç¾é£Ÿã€é€›è¡—', transportType: 'train', transportTime: '15åˆ†' }
                        ]
                    };
                } else {
                    itineraryData.value = JSON.parse(localStorage.getItem('itineraryData'));
                }
                
                if(localStorage.getItem('shoppingList')) shoppingList.value = JSON.parse(localStorage.getItem('shoppingList'));
                if(localStorage.getItem('expenses')) expenses.value = JSON.parse(localStorage.getItem('expenses'));
            };

            const currentDayData = computed(() => tripDays[selectedDayIndex.value]);
            const currentDayItems = computed(() => itineraryData.value[currentDayData.value.fullDate] || []);

            // æ–°å¢/ç·¨è¼¯è¡Œç¨‹ç›¸é—œ
            const showAddModal = ref(false);
            const isEditing = ref(false);
            const editingIndex = ref(-1);
            const formItem = ref({ type: 'spot', name: '', openTime: '', ticket: '', note: '', transportType: 'walk', transportTime: '' });

            const editItem = (item) => {
                isEditing.value = true;
                formItem.value = JSON.parse(JSON.stringify(item)); // Deep copy
                showAddModal.value = true;
            };

            const closeModal = () => {
                showAddModal.value = false;
                isEditing.value = false;
                formItem.value = { type: 'spot', name: '', openTime: '', ticket: '', note: '', transportType: 'walk', transportTime: '' };
            };

            const saveItem = () => {
                const dateKey = currentDayData.value.fullDate;
                if (!itineraryData.value[dateKey]) itineraryData.value[dateKey] = [];
                
                if (isEditing.value) {
                    // æ›´æ–°ç¾æœ‰
                    const list = itineraryData.value[dateKey];
                    const idx = list.findIndex(i => i.id === formItem.value.id);
                    if (idx !== -1) list[idx] = { ...formItem.value };
                } else {
                    // æ–°å¢
                    itineraryData.value[dateKey].push({
                        ...formItem.value,
                        id: Date.now()
                    });
                }
                saveToLocal();
                closeModal();
            };

            const deleteItem = () => {
                if(confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹è¡Œç¨‹å—ï¼Ÿ')) {
                    const dateKey = currentDayData.value.fullDate;
                    itineraryData.value[dateKey] = itineraryData.value[dateKey].filter(i => i.id !== formItem.value.id);
                    saveToLocal();
                    closeModal();
                }
            };

            // æ‹–æ›³æ’åº
            let draggedItemIndex = null;
            const dragStart = (index) => { draggedItemIndex = index; };
            const drop = (index) => {
                const dateKey = currentDayData.value.fullDate;
                const list = itineraryData.value[dateKey];
                const itemToMove = list[draggedItemIndex];
                list.splice(draggedItemIndex, 1);
                list.splice(index, 0, itemToMove);
                saveToLocal();
            };

            // è³¼ç‰©æ¸…å–®
            const showShoppingModal = ref(false);
            const shoppingList = ref([]);
            const shoppingForm = ref({ name: '', image: null });
            
            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => shoppingForm.value.image = e.target.result;
                    reader.readAsDataURL(file);
                }
            };

            const saveShoppingItem = () => {
                shoppingList.value.push({ ...shoppingForm.value });
                shoppingForm.value = { name: '', image: null };
                showShoppingModal.value = false;
                saveToLocal();
            };

            const removeShoppingItem = (index) => {
                if(confirm('åˆªé™¤æ­¤å•†å“ï¼Ÿ')) {
                    shoppingList.value.splice(index, 1);
                    saveToLocal();
                }
            };

            // è¨˜å¸³
            const showExpenseModal = ref(false);
            const expenses = ref([]);
            const expenseForm = ref({ date: new Date().toISOString().split('T')[0], category: 'food', name: '', amount: '', method: 'ç¾é‡‘' });
            const totalExpense = computed(() => expenses.value.reduce((sum, item) => sum + Number(item.amount), 0));
            
            const saveExpense = () => {
                expenses.value.push({ ...expenseForm.value });
                expenseForm.value = { date: new Date().toISOString().split('T')[0], category: 'food', name: '', amount: '', method: 'ç¾é‡‘' };
                showExpenseModal.value = false;
                saveToLocal();
            };

             const removeExpense = (index) => {
                if(confirm('åˆªé™¤æ­¤ç­†æ¶ˆè²»ï¼Ÿ')) {
                    expenses.value.splice(index, 1);
                    saveToLocal();
                }
            };

            // å·¥å…·å‡½å¼
            const calcJpy = ref('');
            const exchangeRate = ref(0.22); // é è¨­åŒ¯ç‡

            const saveToLocal = () => {
                localStorage.setItem('itineraryData', JSON.stringify(itineraryData.value));
                localStorage.setItem('shoppingList', JSON.stringify(shoppingList.value));
                localStorage.setItem('expenses', JSON.stringify(expenses.value));
            };

            const openGoogleMap = (keyword) => {
                window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(keyword)}`, '_blank');
            };

            const openGoogleMapRoute = (origin, dest) => {
                window.open(`https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(origin)}&destination=${encodeURIComponent(dest)}&travelmode=transit`, '_blank');
            };

            // Icon Mapping
            const getWeatherIcon = (type) => {
                const map = { 'sun': 'â˜€ï¸', 'cloud': 'â˜ï¸', 'rain': 'ğŸŒ§ï¸', 'snow': 'â„ï¸' };
                return map[type] || 'ğŸŒ¤ï¸';
            };
            const getTypeColor = (type) => {
                const map = { 'spot': 'bg-pink-400', 'food': 'bg-orange-400', 'shopping': 'bg-purple-400', 'hotel': 'bg-green-500', 'flight': 'bg-blue-500', 'other': 'bg-gray-400' };
                return map[type];
            };
            const getTypeName = (type) => {
                const map = { 'spot': 'æ™¯é»', 'food': 'ç¾é£Ÿ', 'shopping': 'è³¼ç‰©', 'hotel': 'ä½å®¿', 'flight': 'èˆªç­', 'other': 'å…¶ä»–' };
                return map[type];
            };
            const getTransportIcon = (type) => {
                return type === 'walk' ? 'fa-person-walking' : type === 'car' ? 'fa-car' : 'fa-train-subway';
            };
            const getCategoryIcon = (cat) => {
                const map = { 'traffic': 'fa-train', 'food': 'fa-utensils', 'hotel': 'fa-bed', 'ticket': 'fa-ticket', 'shopping': 'fa-bag-shopping', 'other': 'fa-ellipsis' };
                return map[cat];
            };
            const getCategoryColor = (cat) => {
                const map = { 'traffic': 'bg-blue-400', 'food': 'bg-orange-400', 'hotel': 'bg-green-400', 'ticket': 'bg-red-400', 'shopping': 'bg-purple-400', 'other': 'bg-gray-400' };
                return map[cat];
            };

            onMounted(() => {
                initData();
            });

            return {
                currentTab, tripDays, selectedDayIndex, currentDayItems, currentDayData,
                showAddModal, isEditing, formItem, editItem, closeModal, saveItem, deleteItem,
                dragStart, drop,
                shoppingList, showShoppingModal, shoppingForm, handleImageUpload, saveShoppingItem, removeShoppingItem,
                expenses, showExpenseModal, expenseForm, saveExpense, removeExpense, totalExpense,
                calcJpy, exchangeRate,
                getWeatherIcon, getTypeColor, getTypeName, getTransportIcon, getCategoryIcon, getCategoryColor,
                openGoogleMap, openGoogleMapRoute
            };
        }
    }).mount('#app');
</script>
</body>
</html>